<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Météo Pastel</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, 
                #ffeef8 0%, 
                #f0f4ff 25%, 
                #e8f5e8 50%, 
                #fff0e6 75%, 
                #f8f0ff 100%);
            min-height: 100vh;
            padding: 20px;
            color: #5a5a7a;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            animation: fadeInDown 1s ease-out;
        }

        .title {
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(135deg, #ff9a9e, #a8e6cf, #ffd3a5);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            text-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .subtitle {
            font-size: 1.2rem;
            font-weight: 300;
            color: #8e8ea8;
            opacity: 0.8;
        }

        .weather-card {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(20px);
            border-radius: 30px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.05),
                0 0 0 1px rgba(255, 255, 255, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            animation: fadeInUp 1s ease-out 0.3s both;
            position: relative;
            overflow: hidden;
        }

        .weather-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(
                from 0deg,
                rgba(255, 154, 158, 0.1) 0deg,
                rgba(168, 230, 207, 0.1) 60deg,
                rgba(255, 211, 165, 0.1) 120deg,
                rgba(255, 154, 158, 0.1) 180deg,
                rgba(168, 230, 207, 0.1) 240deg,
                rgba(255, 211, 165, 0.1) 300deg,
                rgba(255, 154, 158, 0.1) 360deg
            );
            animation: rotate 20s linear infinite;
            z-index: -1;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .weather-now {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .weather-stat {
            background: linear-gradient(135deg, 
                rgba(255, 255, 255, 0.8), 
                rgba(255, 255, 255, 0.4));
            border-radius: 20px;
            padding: 20px;
            text-align: center;
            box-shadow: 
                0 10px 20px rgba(0, 0, 0, 0.02),
                inset 0 1px 0 rgba(255, 255, 255, 0.8);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .weather-stat:hover {
            transform: translateY(-5px);
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.08),
                inset 0 1px 0 rgba(255, 255, 255, 0.9);
        }

        .weather-icon {
            font-size: 2rem;
            margin-bottom: 10px;
            display: block;
        }

        .weather-value {
            font-size: 1.5rem;
            font-weight: 600;
            color: #4a4a6a;
            margin-bottom: 5px;
        }

        .weather-label {
            font-size: 0.9rem;
            font-weight: 400;
            color: #8e8ea8;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .forecast-section {
            margin-top: 40px;
        }

        .forecast-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #5a5a7a;
            margin-bottom: 20px;
            text-align: center;
        }

        .forecast-hours {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 15px;
        }

        .forecast-hour {
            background: linear-gradient(135deg, 
                rgba(255, 255, 255, 0.6), 
                rgba(255, 255, 255, 0.2));
            border-radius: 20px;
            padding: 20px 15px;
            text-align: center;
            box-shadow: 
                0 8px 16px rgba(0, 0, 0, 0.03),
                inset 0 1px 0 rgba(255, 255, 255, 0.7);
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.4);
        }

        .forecast-hour:hover {
            transform: translateY(-3px);
            background: linear-gradient(135deg, 
                rgba(255, 255, 255, 0.8), 
                rgba(255, 255, 255, 0.4));
        }

        .forecast-time {
            font-weight: 600;
            color: #4a4a6a;
            font-size: 0.9rem;
            margin-bottom: 8px;
        }

        .forecast-temp {
            font-size: 1.2rem;
            font-weight: 700;
            color: #5a5a7a;
            margin: 5px 0;
        }

        .forecast-desc {
            font-size: 0.8rem;
            color: #8e8ea8;
            line-height: 1.3;
        }

        .logs-section {
            background: rgba(255, 255, 255, 0.5);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 
                0 10px 20px rgba(0, 0, 0, 0.03),
                inset 0 1px 0 rgba(255, 255, 255, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.3);
            animation: fadeInUp 1s ease-out 0.6s both;
        }

        .logs-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #5a5a7a;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logs {
            background: rgba(255, 255, 255, 0.7);
            border-radius: 15px;
            padding: 20px;
            max-height: 150px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            color: #6a6a8a;
            line-height: 1.5;
            white-space: pre-wrap;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
            scrollbar-width: thin;
            scrollbar-color: rgba(168, 230, 207, 0.5) transparent;
        }

        .logs::-webkit-scrollbar {
            width: 6px;
        }

        .logs::-webkit-scrollbar-track {
            background: transparent;
        }

        .logs::-webkit-scrollbar-thumb {
            background: rgba(168, 230, 207, 0.5);
            border-radius: 3px;
        }

        .error {
            background: linear-gradient(135deg, #ffd3d3, #ffe6e6);
            border: 1px solid rgba(255, 182, 182, 0.5);
            color: #8b5a5a;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            font-weight: 500;
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 40px;
            flex-direction: column;
            gap: 20px;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(168, 230, 207, 0.3);
            border-top: 4px solid #a8e6cf;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .loading-text {
            color: #8e8ea8;
            font-weight: 500;
        }

        .refresh-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 30px;
            background: linear-gradient(135deg, #a8e6cf, #ffd3a5);
            border: none;
            cursor: pointer;
            box-shadow: 
                0 10px 20px rgba(0, 0, 0, 0.1),
                0 0 0 1px rgba(255, 255, 255, 0.3);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            animation: fadeInUp 1s ease-out 0.9s both;
        }

        .refresh-btn:hover {
            transform: translateY(-5px) scale(1.1);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }

        .refresh-btn:active {
            transform: translateY(-2px) scale(1.05);
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 768px) {
            .title {
                font-size: 2rem;
            }
            
            .weather-card {
                padding: 25px;
            }
            
            .weather-now {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .forecast-hours {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .refresh-btn {
                width: 50px;
                height: 50px;
                bottom: 20px;
                right: 20px;
            }
        }

        .weather-status {
            text-align: center;
            margin-bottom: 30px;
        }

        .current-time {
            font-size: 1.1rem;
            font-weight: 500;
            color: #6a6a8a;
            margin-bottom: 10px;
        }

        .location {
            font-size: 0.9rem;
            color: #8e8ea8;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">☀️ Météo Douce</h1>
            <p class="subtitle">Prévisions météorologiques en temps réel</p>
        </div>

        <div class="weather-card">
            <div id="weather">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <div class="loading-text">Chargement des données météo...</div>
                </div>
            </div>
        </div>

        <div class="logs-section">
            <div class="logs-title">
                📊 Journal d'activité
            </div>
            <div id="logs" class="logs" aria-live="polite" aria-atomic="true"></div>
        </div>

        <button class="refresh-btn" onclick="loadWeather()" title="Actualiser la météo">
            🔄
        </button>
    </div>

    <script>
        const weatherCodes = {
            0: "Ciel clair",
            2: "Partiellement nuageux",
            3: "Couvert",
            45: "Brouillard",
            48: "Brume givrée",
            51: "Bruine légère",
            53: "Bruine modérée",
            55: "Bruine dense",
            56: "Bruine verglaçante légère",
            57: "Bruine verglaçante dense",
            61: "Pluie faible",
            63: "Pluie modérée",
            65: "Pluie forte",
            66: "Pluie verglacante faible",
            67: "Pluie verglaçante forte",
            71: "Neige faible",
            73: "Neige modérée",
            75: "Neige forte",
            77: "Granules de neige",
            80: "Averses faibles",
            81: "Averses modérées",
            82: "Averses fortes",
            85: "Averses de neige faibles",
            86: "Averses de neige fortes",
            95: "Orages",
            96: "Orages faibles",
            99: "Orages forts"
        };

        const weatherIcons = {
            0: "☀️", 2: "⛅", 3: "☁️", 45: "🌫️", 48: "🌫️",
            51: "🌦️", 53: "🌦️", 55: "🌦️", 56: "🌧️", 57: "🌧️",
            61: "🌧️", 63: "🌧️", 65: "⛈️", 66: "🌨️", 67: "🌨️",
            71: "❄️", 73: "❄️", 75: "❄️", 77: "❄️",
            80: "🌦️", 81: "🌦️", 82: "⛈️", 85: "🌨️", 86: "🌨️",
            95: "⛈️", 96: "⛈️", 99: "⛈️"
        };

        function log(msg) {
            const logs = document.getElementById("logs");
            const timestamp = new Date().toLocaleTimeString('fr-FR');
            logs.innerText += `[${timestamp}] ${msg}\n`;
            logs.scrollTop = logs.scrollHeight;
        }

        async function getLocation() {
            log("📍 Récupération de votre position...");
            return new Promise(resolve => {
                let resolved = false;
                const timer = setTimeout(() => {
                    if (!resolved) {
                        resolved = true;
                        log("⏳ Timeout dépassé, utilisation de Paris par défaut");
                        resolve({ lat: 48.8566, lon: 2.3522, city: "Paris" });
                    }
                }, 5000);

                if ("geolocation" in navigator) {
                    navigator.geolocation.getCurrentPosition(
                        async pos => {
                            if (!resolved) {
                                resolved = true;
                                clearTimeout(timer);
                                log("✅ Position géographique obtenue avec succès");
                                
                                // Obtenir le nom de la ville via reverse geocoding
                                try {
                                    const response = await fetch(
                                        `https://api.open-meteo.com/v1/forecast?latitude=${pos.coords.latitude}&longitude=${pos.coords.longitude}&current_weather=true&hourly=temperature_2m,weathercode&forecast_days=1`
                                    );
                                    resolve({ 
                                        lat: pos.coords.latitude, 
                                        lon: pos.coords.longitude, 
                                        city: "Votre position" 
                                    });
                                } catch (e) {
                                    resolve({ 
                                        lat: pos.coords.latitude, 
                                        lon: pos.coords.longitude, 
                                        city: "Position actuelle" 
                                    });
                                }
                            }
                        },
                        error => {
                            if (!resolved) {
                                resolved = true;
                                clearTimeout(timer);
                                log("⚠️ Accès à la géolocalisation refusé, utilisation de Paris");
                                resolve({ lat: 48.8566, lon: 2.3522, city: "Paris" });
                            }
                        },
                        {
                            timeout: 4000,
                            enableHighAccuracy: true
                        }
                    );
                } else {
                    resolved = true;
                    log("⚠️ Géolocalisation non disponible, utilisation de Paris");
                    resolve({ lat: 48.8566, lon: 2.3522, city: "Paris" });
                }
            });
        }

        async function getWeather(lat, lon) {
            log("⛅ Récupération des données météorologiques...");
            try {
                const res = await fetch(
                    `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&hourly=temperature_2m,weathercode&forecast_days=1&timezone=auto`
                );
                if (!res.ok) throw new Error(`Erreur HTTP: ${res.status}`);
                const data = await res.json();
                log("✅ Données météo reçues avec succès");
                return data;
            } catch (e) {
                log("❌ Erreur lors de la récupération météo : " + e.message);
                return null;
            }
        }

        function buildWeather(weather, location) {
            if (!weather || !weather.current_weather) {
                return '<div class="error">❌ Données météorologiques indisponibles</div>';
            }

            const cur = weather.current_weather;
            const description = weatherCodes[cur.weathercode] || "Conditions inconnues";
            const icon = weatherIcons[cur.weathercode] || "🌤️";
            
            const currentTime = new Date(cur.time).toLocaleString('fr-FR', {
                weekday: 'long',
                day: 'numeric',
                month: 'long',
                hour: '2-digit',
                minute: '2-digit'
            });

            let html = `
                <div class="weather-status">
                    <div class="current-time">${currentTime}</div>
                    <div class="location">📍 ${location.city}</div>
                </div>
                
                <div class="weather-now">
                    <div class="weather-stat">
                        <span class="weather-icon">🌡️</span>
                        <div class="weather-value">${cur.temperature}°C</div>
                        <div class="weather-label">Température</div>
                    </div>
                    <div class="weather-stat">
                        <span class="weather-icon">💨</span>
                        <div class="weather-value">${cur.windspeed} km/h</div>
                        <div class="weather-label">Vent</div>
                    </div>
                    <div class="weather-stat">
                        <span class="weather-icon">${icon}</span>
                        <div class="weather-value" style="font-size: 1rem; line-height: 1.3;">${description}</div>
                        <div class="weather-label">Conditions</div>
                    </div>
                </div>

                <div class="forecast-section">
                    <h3 class="forecast-title">🕐 Prévisions horaires</h3>
                    <div class="forecast-hours">
            `;

            // Afficher les prévisions par tranches de 3 heures
            for (let i = 0; i < Math.min(weather.hourly.time.length, 24); i += 3) {
                const hour = new Date(weather.hourly.time[i]).toLocaleTimeString('fr-FR', {
                    hour: "2-digit",
                    minute: "2-digit"
                });
                const temp = Math.round(weather.hourly.temperature_2m[i]);
                const desc = weatherCodes[weather.hourly.weathercode[i]] || "?";
                const hourIcon = weatherIcons[weather.hourly.weathercode[i]] || "🌤️";

                html += `
                    <div class="forecast-hour">
                        <div class="forecast-time">${hour}</div>
                        <div style="font-size: 1.5rem; margin: 8px 0;">${hourIcon}</div>
                        <div class="forecast-temp">${temp}°C</div>
                        <div class="forecast-desc">${desc}</div>
                    </div>
                `;
            }

            html += "</div></div>";
            return html;
        }

        async function loadWeather() {
            const weatherElement = document.getElementById("weather");
            
            // Afficher le spinner de chargement
            weatherElement.innerHTML = `
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <div class="loading-text">Actualisation en cours...</div>
                </div>
            `;

            try {
                log("🔄 Démarrage de l'actualisation météo");
                const location = await getLocation();
                const weatherData = await getWeather(location.lat, location.lon);
                weatherElement.innerHTML = buildWeather(weatherData, location);
                log("🎉 Météo mise à jour avec succès !");
            } catch (error) {
                log("💥 Erreur critique : " + error.message);
                weatherElement.innerHTML = `
                    <div class="error">
                        ❌ Impossible de charger les données météo.<br>
                        <small>Vérifiez votre connexion internet et réessayez.</small>
                    </div>
                `;
            }
        }

        // Initialisation au chargement de la page
        document.addEventListener('DOMContentLoaded', () => {
            log("🚀 Application météo initialisée");
            loadWeather();
        });

        // Actualisation automatique toutes les 10 minutes
        setInterval(() => {
            log("⏰ Actualisation automatique programmée");
            loadWeather();
        }, 600000); // 10 minutes
    </script>
</body>
</html>