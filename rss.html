<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Actus Tech â€” RSS</title>
  <style>
    :root {
      --bg: #ffffff;
      --fg: #000000;
      --muted: #333333;
      --border: #000000;
    }
    html, body { height: 100%; margin: 0; padding: 0; }
    body {
      margin: 0; padding: 24px;
      background: var(--bg);
      color: var(--fg);
      font-family: "Courier New", Courier, monospace;
      line-height: 1.5;
    }

    .container { max-width: 960px; margin: 0 auto; padding: 0 12px; }

    h1 {
      font-size: 28px; font-weight: 700; letter-spacing: 0.5px;
      margin: 0 0 16px 0;
      border-bottom: 2px dotted var(--border);
      padding-bottom: 6px;
    }

    .sub { margin: 0 0 24px 0; font-size: 14px; color: var(--muted); }

    .controls { display: flex; flex-wrap: wrap; gap: 8px; align-items: center; margin-bottom: 18px; border: 1px solid var(--border); padding: 10px; border-radius: 2px; }
    .controls label { font-size: 14px; }

    button, select, input[type="number"] {
      appearance: none; -webkit-appearance: none; -moz-appearance: none;
      border: 1px solid var(--border); background: var(--bg); color: var(--fg);
      padding: 8px 10px; border-radius: 2px; font-family: inherit; font-size: 14px;
    }
    button { cursor: pointer; }
    button:hover { filter: invert(100%); }
    select:hover, input[type="number"]:hover { background: #f5f5f5; }

    .source-title { font-size: 18px; margin: 28px 0 10px 0; font-weight: 700; display: inline-block; border-bottom: 2px solid var(--border); }
    .news { border: 1px solid var(--border); padding: 12px; margin-bottom: 10px; border-radius: 2px; background: var(--bg); }
    .news h2 { font-size: 16px; margin: 0 0 6px 0; }
    .news a { color: var(--fg); text-decoration: underline; text-underline-offset: 2px; }
    .news a:hover { background: #000; color: #fff; }
    .meta { font-size: 12px; color: var(--muted); }

    .cursor::after { content: "â–Œ"; margin-left: 6px; animation: blink 1s steps(1,end) infinite; }
    @keyframes blink { 50% { opacity: 0; } }

    footer { margin-top: 40px; text-align: center; font-size: 14px; }

    @media(max-width: 600px) {
      h1 { font-size: 22px; }
      .controls { flex-direction: column; align-items: flex-start; }
      .news h2 { font-size: 14px; }
      .source-title { font-size: 16px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ðŸ“° Actus Tech <span class="cursor"></span></h1>
    <p class="sub">FrAndroid â€¢ Korben â€¢ RaspberryTips â€¢ Gamekult â€¢ Le Journal du Geek â€¢ Actuia Hardware and Co â€¢ DÃ©veloppez.com â€” RSS, regroupÃ©s par source. RafraÃ®chir et filtrer sans recharger la page.</p>

    <div class="controls">
      <button id="refreshBtn" title="Recharger les flux">ðŸ”„ RafraÃ®chir</button>
      <label for="filter">Filtre :</label>
      <select id="filter">
        <option value="all">Toutes les sources</option>
        <option value="www.frandroid.com">FrAndroid</option>
        <option value="korben.info">Korben</option>
        <option value="raspberrytips.fr">RaspberryTips</option>
        <option value="www.gamekult.com">Gamekult</option>
        <option value="www.journaldugeek.com">Le Journal du Geek</option>
        <option value="www.actuia.com">Actuia Hardware and Co</option>
        <option value="web.developpez.com">DÃ©veloppez.com</option>
      </select>
      <label for="limit">Articles/source :</label>
      <input id="limit" type="number" min="1" max="50" value="25" />
      <label for="autorefresh">Auto-refresh (min) :</label>
      <input id="autorefresh" type="number" min="0" max="120" value="0" />
    </div>

    <div id="news-container">Chargementâ€¦</div>
  </div>

  <footer>
    <button id="footerRefreshBtn">ðŸ”„ RafraÃ®chir</button>
  </footer>

  <script>
    const FEEDS = [
      "https://www.frandroid.com/feed",
      "https://korben.info/feed",
      "https://raspberrytips.fr/feed/",
      "https://www.gamekult.com/feeds/actu.html",
      "https://www.journaldugeek.com/feed",
      "https://www.actuia.com/feed",
      "https://web.developpez.com/index/rss"
    ];

    let allFeeds = [];
    let autoTimer = null;

    document.getElementById('refreshBtn').addEventListener('click', () => loadNews());
    document.getElementById('footerRefreshBtn').addEventListener('click', () => loadNews());
    document.getElementById('filter').addEventListener('change', () => render());
    document.getElementById('limit').addEventListener('change', () => render());
    document.getElementById('autorefresh').addEventListener('change', onAutoRefreshChange);

    function onAutoRefreshChange() {
      const mins = parseInt(document.getElementById('autorefresh').value || '0', 10);
      if (autoTimer) { clearInterval(autoTimer); autoTimer = null; }
      if (mins > 0) autoTimer = setInterval(loadNews, mins * 60 * 1000);
    }

    async function getRSS(url) {
      const proxy = 'https://api.rss2json.com/v1/api.json?rss_url=' + encodeURIComponent(url);
      const res = await fetch(proxy);
      if (!res.ok) throw new Error('Erreur rÃ©seau');
      const data = await res.json();
      if (!data.items || data.items.length === 0) throw new Error('Aucun article trouvÃ©');
      return data.items.map(item => ({
        title: item.title || 'Sans titre',
        link: item.link || '#',
        description: (item.content || item.description || '').replace(/<script[^>]*>.*?<\/script>/g, '').replace(/<style[^>]*>.*?<\/style>/g, '').replace(/<img[^>]*>/g,'').replace(/\s+/g,' ').trim(),
        date: item.pubDate || '',
        isoDate: item.pubDate ? new Date(item.pubDate).toISOString() : ''
      }));
    }

    async function loadNews() {
      const container = document.getElementById('news-container');
      container.textContent = 'Chargementâ€¦';

      allFeeds = [];
      for (const feed of FEEDS) {
        const source = new URL(feed).hostname;
        try {
          const articles = await getRSS(feed);
          allFeeds.push({ source, articles });
        } catch (e) {
          allFeeds.push({ source, articles: [{ title: 'Erreur de chargement du flux', link: '#', description: String(e.message || e), date: '', isoDate: '' }] });
        }
      }

      render();
    }

    function render() {
      const container = document.getElementById('news-container');
      const filter = document.getElementById('filter').value;
      const limit = Math.max(1, Math.min(50, parseInt(document.getElementById('limit').value || '25', 10)));

      container.innerHTML = '';

      let feedsToRender = [...allFeeds];
      if (filter === 'all') {
        feedsToRender = feedsToRender.flatMap(feed => feed.articles.map(a => ({...a, source: feed.source})))
                                   .sort(() => Math.random() - 0.5)
                                   .slice(0, limit * feedsToRender.length);
        feedsToRender.forEach(article => {
          const div = document.createElement('div');
          div.className = 'news';
          const dateTxt = article.date ? `ðŸ“… ${article.date}` : '';
          div.innerHTML = `
            <h2><a href="${article.link}" target="_blank" rel="noopener noreferrer">${article.title}</a></h2>
            <div class="meta">${dateTxt}</div>
            <p>${article.description}</p>
          `;
          container.appendChild(div);
        });
        return;
      }

      feedsToRender.forEach(feed => {
        if (filter !== 'all' && feed.source !== filter) return;
        const title = document.createElement('div');
        title.className = 'source-title';
        title.textContent = `ðŸ”— ${feed.source}`;
        container.appendChild(title);

        feed.articles.slice(0, limit).forEach(article => {
          const div = document.createElement('div');
          div.className = 'news';
          const dateTxt = article.date ? `ðŸ“… ${article.date}` : '';
          div.innerHTML = `
            <h2><a href="${article.link}" target="_blank" rel="noopener noreferrer">${article.title}</a></h2>
            <div class="meta">${dateTxt}</div>
            <p>${article.description}</p>
          `;
          container.appendChild(div);
        });
      });

      if (!container.hasChildNodes()) {
        const empty = document.createElement('div');
        empty.textContent = 'Aucun article pour ce filtre.';
        container.appendChild(empty);
      }
    }

    loadNews();
    onAutoRefreshChange();
  </script>
</body>
</html>
